{%load static%}
<div role="tabpanel" id="tabpanel">
  <div class="container">
    <div class="area_raid">
      <div class="character">
        <img src="https://i.imgur.com/inTtFRH.png" alt="카멘" />
        <span style="font-size: small">카멘</span>
      </div>

      <div class="character">
        <img src="https://i.imgur.com/QXnwSY8.png" alt="일리아칸" />
        <span style="font-size: small">일리아칸</span>
      </div>
    </div>

    <div>
      <div class="normalhardForm">
        <form action="#" name="difficulty" method="get" id="normalhardForm">
          <div>
            <button class="closeBtn" onclick="closeForm();">X</button>
          </div>
          <div>
          <fieldset class="totalField">
            <legend>난이도 선택</legend>
            <fieldset class="stageSet">
              <legend>1관문</legend>
              <select name="stage1" size="3" id="stage1">
                <option value="normal">노말</option>
                <option value="hard">하드</option>
              </select>
                <div>
                  더보기 함<input
                    type="checkBox"
                    class="bonus"
                    value="yes"
                    onchange="checkboxGroup(this)"
                  />
                </div>
            </fieldset>
            <fieldset class="stageSet">
              <legend>2관문</legend>
              <select name="stage2" size="3" id="stage2">
                <option value="normal">노말</option>
                <option value="hard">하드</option>
                <option value="dont">안함</option>
              </select>
              <div>
                <div>
                  더보기 함<input
                    type="checkBox"
                    class="bonus"
                    value="yes"
                    onchange="checkboxGroup(this)"
                  />
                </div>
              </div>
            </fieldset>
            <fieldset class="stageSet">
              <legend>3관문</legend>
              <select name="stage3" size="3" id="stage3">
                <option value="normal">노말</option>
                <option value="hard">하드</option>
                <option value="dont">안함</option>
              </select>
              <div>
                <div>
                  더보기 함<input
                    type="checkBox"
                    class="bonus"
                    value="yes"
                    onchange="checkboxGroup(this)"
                  />
                </div>
              </div>
            </fieldset>
            <fieldset class="stageSet">
              <legend>4관문</legend>
              <select name="stage4" size="3" id="stage4">
                <option value="hard">하드</option>
                <option value="dont">안함</option>
              </select>
              <div>
                <div>
                  더보기 함<input
                    type="checkBox"
                    class="bonus"
                    value="yes"
                    onchange="checkboxGroup(this)"
                  />
                </div>
            </fieldset>
            </div>
            <div class="bonusGroup">
                <button class="calculateBtn" type="submit" form="normalhardForm">계산</button>
            </div>
          </div>
          </fieldset>
        </form>
      </div>

    <div class="quickSlot">
      소지 재료 갯수 :
      <input type="number" class="count_ingredient" min="0" /> 손길 :
      <input type="number" class="hand" max="5" min="0" />
      경매<input type="checkBox" class="hand" /> 첫클보상<input
        type="checkBox"
        class="hand"
      />
    </div>
    <div>
      전체 더보기----
      <input
        type="checkBox"
        class="bonus"
        value="yes"
        onclick="selectAllyes(this)"
      />
      <button class="filter" onclick="showFilter()">필터</button>
    </div>
    <div class="tableContainer" onwheel="handleWheel(event)">
      <table class="tableRoot">
        <thead class="tableHead">
          <tr class="tableHead_root">
            <th class="tableCell" scope="col">(주 차)</th>
            {% for i in result.0.enter %}
              <th class="tableCell_under" scope="col">{{forloop.counter}} 관문/더보기</th>
            {% endfor %}
            <th class="tableCell" scope="col">(경 매)</th>
            <th class="tableCell" scope="col">(획득 재료)</th>
            <th class="tableCell" scope="col">(누적 재료)</th>
            <th class="tableCell" scope="col">(소모 골드)</th>
            <th class="tableCell" scope="col">(손길 적용)</th>
          </tr>
        </thead>
        <tbody class="tableBody">
          {% for res in result reversed %}
          <tr class="tableBody_root">
            <td class="tableCell" scope="col">{{res.week}}주</td>
            {% for stg in res.enter %}
              {% if stg == 1 %}
                <td class="tableCell" scope="col">노말 / O</td>
              {% elif stg == 2 %}
                <td class="tableCell" scope="col">노말 / X</td>
              {% elif stg == 3 %}
                <td class="tableCell" scope="col">하드 / O</td>
              {% elif stg == 4 %}
                <td class="tableCell" scope="col">하드 / X</td>
              {% else %}
                <td class="tableCell" scope="col"></td>
              {% endif %}
            {% endfor%}
            <td class="tableCell" scope="col">{{res.auction}}</td>
            <td class="tableCell" scope="col"><img src={{materialImg}} alt="어둠의 불">{{res.material}}</td>
            <td class="tableCell" scope="col">{{res.accum}}</td>
            <td class="tableCell" scope="col">{{res.gold}}<img src="https://i.imgur.com/2SWmGw4.png" alt="골드"></td>
            <td class="tableCell" scope="col">{{res.hands}}</td>
          </tr>

          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
<script>
  function showFilter() {
    const filter = document.querySelector(".normalhardForm");
    if (filter.style.display !== "none") {
      filter.style.display = "none";
    } else {
      filter.style.display = "block";
    }
  }

  function selectAllyes(selectAll) {
    const checkboxes = document.querySelectorAll(".bonus");
    Array.from(checkboxes).forEach((checkbox) => {
      checkbox.checked = selectAll.checked;
    });
  }

  function handleWheel(event) {
    const tableContainer = document.querySelector(".tableContainer");
    tableContainer.scrollBy(0, event.deltaY);
  }
      function checkboxGroup(currentCheckbox) {
        const parentFieldset = currentCheckbox.closest('.stageSet'); 
        const checkboxes = parentFieldset.querySelectorAll('.bonus');
          
        for (let i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i] !== currentCheckbox) { 
                checkboxes[i].checked = false;
            }
        }
      }

      function closeForm() {
        const filter = document.querySelector(".normalhardForm");
        if (filter.style.display !== "none") {
          filter.style.display = "none";
        } else {
          filter.style.display = "block";
        }
      }
</script>
